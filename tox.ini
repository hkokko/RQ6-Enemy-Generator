# Tox configuration to run pytest and Django's unittest runner
# Assumption: the environment (DB/container) is already up; tox will not start services.

[tox]
skipsdist = true
envlist = py310

[testenv]
deps =
    -rrequirements.txt
    -rrequirements_dev.txt

setenv =
    DJANGO_SETTINGS_MODULE = settings
    # Add Apple Silicon Homebrew paths; harmless elsewhere
    PATH = /opt/homebrew/bin:{env:PATH}
    DYLD_FALLBACK_LIBRARY_PATH = /opt/homebrew/lib:{env:DYLD_FALLBACK_LIBRARY_PATH}

passenv =
    DB_*
    db_user
    db_password
    MYSQL_*
    SKIP_TEST_LOADDATA
    PYTEST_ADDOPTS
    PATH
    DYLD_FALLBACK_LIBRARY_PATH

# Only verifies cairo on Apple Silicon; prints a skip message otherwise.
commands_pre =
    python tools/check_cairo.py

commands =
    pytest -vv
    # -m "not infra"
    python manage.py test enemygen.tests enemygen.legacy_tests --verbosity=2