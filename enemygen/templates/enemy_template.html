{% extends "base.html" %}
{% load url from future %}

{% block title %}RQ: {{ et.name }}{% endblock %}

{% block content %}

<script>
$(document).ready(function(){
    var cly = completely(document.getElementById('et_newtag'), {
        fontSize: '12px',
    	fontFamily : 'Arial',
        color: 'black',
    });
    cly.input.style.border= '1px solid #ABADB3';
    cly.input.style.width= '200px';
    cly.wrapper.style.width= '200px';
    cly.input.style.padding='1px';
    cly.options = [{% for t in all_et_tags %}'{{t}}',{% endfor %}];
    cly.onEnter = function(){
        var new_value = cly.getText();
        var item_id = {{ et.id }};
        var item_type = 'et_newtag';
        var input_object = null;
        submit(item_id, item_type, input_object, new_value);
        $('#tag_container').append('<div class="tag">'+new_value+'         \
        <img class="del_tag" src="/rq_static/images/del_tag.png" \
                et_id="{{ et.id }}" value="'+new_value+'"                           \
                onmouseover="this.src=\'/rq_static/images/del_tag_hover.png\'"      \
                onmouseout="this.src=\'/rq_static/images/del_tag.png\'"             \
                onmouseup="this.src=\'/rq_static/images/del_tag.png\'"              \
                onmousedown="this.src=\'/rq_static/images/del_tag_active.png\'" />  \
              </div>');
        $('.del_tag').click(function(event){
            deltag(event);
        })
        cly.setText('');
    };
    cly.onChange = function(){
        text = capitalize(cly.getText())
        cly.setText(text)
        if (text != ''){
            cly.repaint();
        } else {
            cly.hideDropDown();
        }
    }
    
});
</script>

<div> <!-- Buttons -->
    <form action="{% url 'delete_template' et.id %}" method="post">
    {% csrf_token %}
    <div id="delete_template"><input type="submit" value="Delete template" /></div>
    </form>

    <div id="clone_template_container">
    <form action="{% url 'clone_template' et.id %}" method="post">
    {% csrf_token %}
    <input id="clone_template" type="submit" value="Clone" />
    </form>
    </div>

    <div id="generate_enemy_container">
    <form action="{% url 'generate_enemies' %}" method="post" target="generated">
    {% csrf_token %}
    <input name="enemy_template_id_{{et.id}}" type="hidden" value="4">
    <input name="dont_increment" type="hidden" value="1">
    <input style="width: 140px;" type="submit" value="Generate" />
    </form>
    </div>
</div>

<h3>Enemy details</h3>
<table><tr>
    <th>Template name</th>
    <td><input id="et_{{ et.id }}" class="data" type="text" size="40" item_id="{{ et.id }}" item_type="et_name" value="{{ et.name }}" /></td>
</tr><tr>
    <th>Tags</th>
    <td><div id="tag_container">
        {% for tag in et.get_tags %}
            <div class="tag">{{ tag }}
            <img class="del_tag" src="/rq_static/images/del_tag.png"
                 et_id="{{ et.id }}" value="{{ tag }}"
                 onmouseover="this.src='/rq_static/images/del_tag_hover.png'"
                 onmouseout="this.src='/rq_static/images/del_tag.png'"
                 onmouseup="this.src='/rq_static/images/del_tag.png'"
                 onmousedown="this.src='/rq_static/images/del_tag_active.png'" />
            </div>
        {% endfor %}
        </div>
        <div id="et_newtag" class="data" type="text" item_id="{{ et.id }}" item_type="et_newtag"></div>
    </td>
</tr><tr>
    <th>Rank</th>
    <td>
        <select id="et_rank_{{ et.id }}" class="data" item_id="{{ et.id }}" item_type="et_rank">
            <option value="1" {% if et.rank == 1 %}selected="selected"{% endif %}>Rabble</option>
            <option value="2" {% if et.rank == 2 %}selected="selected"{% endif %}>Novice</option>
            <option value="3" {% if et.rank == 3 %}selected="selected"{% endif %}>Skilled</option>
            <option value="4" {% if et.rank == 4 %}selected="selected"{% endif %}>Veteran</option>
            <option value="5" {% if et.rank == 5 %}selected="selected"{% endif %}>Master</option>
        </select>
    </td>
</tr><tr>
    <th>Race</th>
    <td><a class="edit_item" href="{% url 'race' et.race.id %}">{{ et.race.name }}</a></td>
</tr><tr>
    <th>Cult Rank</th>
    <td>
        <select id="et_cult_rank_{{ et.id }}" class="data" item_id="{{ et.id }}" item_type="et_cult_rank">
            {% if et.is_theist %}
                <option value="0" {% if et.cult_rank == 0 %}selected="selected"{% endif %}>None</option>
                <option value="1" {% if et.cult_rank == 1 %}selected="selected"{% endif %}>Lay Member</option>
                <option value="2" {% if et.cult_rank == 2 %}selected="selected"{% endif %}>Initiate</option>
                <option value="3" {% if et.cult_rank == 3 %}selected="selected"{% endif %}>Acolyte</option>
                <option value="4" {% if et.cult_rank == 4 %}selected="selected"{% endif %}>Priest</option>
                <option value="5" {% if et.cult_rank == 5 %}selected="selected"{% endif %}>High Priest</option>
            {% else %}
                <option value="0" {% if et.cult_rank == 0 %}selected="selected"{% endif %}>None</option>
                <option value="1" {% if et.cult_rank == 1 %}selected="selected"{% endif %}>Common</option>
                <option value="2" {% if et.cult_rank == 2 %}selected="selected"{% endif %}>Dedicated</option>
                <option value="3" {% if et.cult_rank == 3 %}selected="selected"{% endif %}>Proven</option>
                <option value="4" {% if et.cult_rank == 4 %}selected="selected"{% endif %}>Overseer</option>
                <option value="5" {% if et.cult_rank == 5 %}selected="selected"{% endif %}>Leader</option>
            {% endif %}
        </select>
    </td>
</tr><tr>
    <th>Published</th>
    <td><input id="et_pub_{{ et.id }}" class="data" type="checkbox" item_id="{{ et.id }}" item_type="et_published" {% if et.published %}checked="checked"{% endif %} /></td>
</tr><tr>
    <th>Notes</th>
    <td><textarea id="et_notes_{{ et.id }}" class="data" cols="60" rows="3" item_id="{{ et.id }}" item_type="et_notes">{{ et.notes }}</textarea></td>
</tr></table>

<table id="stats_and_hp"><tr><td valign="top">
<table>
<tr><th colspan="2">Stats</th></tr>
{% for stat in et.stats %}
    <tr>
        <td>{{ stat.name }}</td>
        <td>
            <input id="stat_{{stat.id}}" class="data" type="text" size="8" item_id="{{stat.id}}" item_type="et_stat_value" value="{{ stat.die_set }}" />
        </td>
    </tr>
{% endfor %}
</table>
{% if et.hit_locations %}
</td><td valign="top">
<table>
<tr><th>D20</th><th>Hit location</th><th>Armor</th></tr>
{% for hl in et.hit_locations %}
    <tr>
        <td>{{ hl.range|safe }}</td>
        <td>{{ hl.name }}</td>
        <td>
            <input id="hl_{{hl.id}}" class="data" type="text" size="10" item_id="{{hl.id}}" item_type="et_hl_armor" value="{{ hl.armor }}" />
        </td>
    </tr>
{% endfor %}
</table>
{% endif %}
</td><td valign="top">
<table>
<tr><th colspan="2">Attributes</th></tr>
<tr>
    <td>Movement</td>
    <td><input id="movement_{{et.id}}" class="data" type="text" size="8" item_id="{{et.id}}" item_type="et_movement" value="{{ et.movement }}" /></td>
</tr>
</table>
</td></tr></table>

<div> <!-- Additional Features -->
    {% if et.additional_features %}
        <h3>Additional features</h3>
        <table>
<tr><th>Feature</th><th>Probability</th><th></th><th></th></tr>
{% for f in et.additional_features %}
    <tr>
        <td>{{ f.name }}</td>
        <td><input id="et_feature_{{f.id}}" class="data" type="text" size="30" item_id="{{f.id}}" item_type="et_feature_prob" value="{{ f.probability }}" />%</td>
        <td><img src="/rq_static/minus.png" width="23" height="23" class="del_item" item_id="{{ f.id }}" item_type="et_additional_feature" /></td>
        <td><a href="{% url 'feature_items' f.feature_list.id %}">View items</a></td>
    </tr>
{% endfor %}
        </table>
    {% endif %}
</div>
<select id="additional_feature_options">
        <option value="0">Select feature</option>
    {% for feature_list in additional_feature_lists %}
        <option value="{{ feature_list.id }}">{{ feature_list.name }}</option>
    {% endfor %}
</select>
<button class="add_additional_feature" et_id="{{ et.id }}">Add additional feature</button>

{% include 'enemy_template_skills.html' %}

{% if not et.is_spirit %}
    {% include 'enemy_template_weapons.html' %}
{% endif %}

{% include 'enemy_template_spells.html' %}

{% endblock %}
