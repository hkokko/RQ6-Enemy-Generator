{% extends "base.html" %}
{% load static %}

{% block content %}

{% if race_admin %}
<div class="mb-4">
  <div class="card shadow-sm">
    <div class="card-body d-flex justify-content-between align-items-center">
      <div>
        <h5 class="card-title mb-1">Races</h5>
        <p class="card-text text-muted mb-0">Manage available races and their hit locations.</p>
      </div>
      <a href="{% url 'race_index' %}" class="btn btn-outline-primary">Manage Races</a>
    </div>
  </div>
</div>
{% endif %}

<div class="row g-4">
  <div class="col-12 col-lg-4">
    <div class="card h-100 shadow-sm">
      <div class="card-body">
        <h3 class="h5">Enemy Templates</h3>
        <form action="{% url 'create_enemy_template'%}" method="post" class="mt-3">
          {% csrf_token %}
          <label class="form-label">Select race for the new template</label>
          <select size="5" name="race_id" class="form-select mb-3">
            {% for race in races %}
              <option value="{{ race.id }}">{{ race.name }}</option>
            {% endfor %}
          </select>
          <button type="submit" class="btn btn-primary">Create new template</button>
        </form>

        <hr class="my-4">

        <h3 class="h5">My Enemy Templates</h3>
        <div class="mb-2">
          <label for="template_searchinput" class="form-label">Search</label>
          <input id="template_searchinput" class="form-control" />
        </div>

        {% if enemy_templates %}
        <div class="table-responsive">
          <table id="my_enemy_template_list" class="table table-sm align-middle">
            <thead>
              <tr>
                <th scope="col" style="width:32px"></th>
                <th scope="col" class="sort-alpha">Template name</th>
                <th scope="col" class="sort-alpha">Race</th>
                <th scope="col" class="sort-alpha">Rank</th>
              </tr>
            </thead>
            <tbody>
            {% for et in enemy_templates %}
              <tr>
                <td>
                  {% if et.starred %}
                    <img et_id={{ et.id }} class="star" height="22" width="22" src="{% static 'images/star_filled.png' %}"/>
                  {% else %}
                    <img et_id={{ et.id }} class="star" height="22" width="22" src="{% static 'images/star_empty.png' %}"/>
                  {% endif %}
                </td>
                <td><a class="edit_item" href="{% url 'enemy_template' et.id %}">{{ et.name }}</a>{% if not et.published %} <span class="text-muted">*</span>{% endif %}</td>
                <td><a class="edit_item" href="{% url 'race' et.race.id %}">{{ et.race.name }}</a></td>
                <td>
                  {% if et.rank == 1 %}Rubble{% endif %}
                  {% if et.rank == 2 %}Novice{% endif %}
                  {% if et.rank == 3 %}Skilled{% endif %}
                  {% if et.rank == 4 %}Veteran{% endif %}
                  {% if et.rank == 5 %}Master{% endif %}
                </td>
              </tr>
            {% endfor %}
            </tbody>
          </table>
        </div>
        {% endif %}
      </div>
    </div>
  </div>

  <div class="col-12 col-lg-4">
    <div class="card h-100 shadow-sm">
      <div class="card-body">
        <h3 class="h5">Cults</h3>
        <div class="mb-2">
          <label for="cult_searchinput" class="form-label">Search</label>
          <input id="cult_searchinput" class="form-control" />
        </div>
        <form action="{% url 'create_cult'%}" method="post" class="mb-3">
          {% csrf_token %}
          <button type="submit" class="btn btn-primary">Create new cult</button>
        </form>
        <div class="table-responsive">
          <table id="cult_table" class="table table-sm">
            <tbody>
              {% for cult in edit_cults %}
              <tr>
                <td><a class="edit_item" href="{% url 'enemy_template' cult.id %}">{{ cult.name }}</a>{% if not cult.published %} <span class="text-muted">*</span>{% endif %}</td>
              </tr>
              {% endfor %}
            </tbody>
          </table>
        </div>
      </div>
    </div>
  </div>

  <div class="col-12 col-lg-4">
    <div class="card h-100 shadow-sm">
      <div class="card-body">
        <h3 class="h5">Parties</h3>
        <div class="mb-2">
          <label for="party_searchinput" class="form-label">Search</label>
          <input id="party_searchinput" class="form-control" />
        </div>
        <form action="{% url 'create_party'%}" method="post" class="mb-3">
          {% csrf_token %}
          <button type="submit" class="btn btn-primary">Create new party</button>
        </form>
        <div class="table-responsive">
          <table id="party_table" class="table table-sm">
            <tbody>
              {% for party in edit_parties %}
              <tr>
                <td><a class="edit_item" href="{% url 'party' party.id %}">{{ party.name }}</a>{% if not party.published %} <span class="text-muted">*</span>{% endif %}</td>
              </tr>
              {% endfor %}
            </tbody>
          </table>
        </div>
      </div>
    </div>
  </div>
</div>

<p class="mt-2 text-muted">* Unpublished</p>

<script>
$(document).ready(function(){
    var table = new ttable('my_enemy_template_list');
    table.sorting.enabled = true;
    table.sorting.sortall = false;
    table.search.enabled = true;
    table.search.inputID = 'template_searchinput';
    table.search.casesensitive = false;
    table.style.num = false;
    table.rendertable();

    var table = new ttable('cult_table');
    table.search.enabled = true;
    table.search.inputID = 'cult_searchinput';
    table.search.casesensitive = false;
    table.style.num = false;
    table.rendertable();

    var table = new ttable('party_table');
    table.search.enabled = true;
    table.search.inputID = 'party_searchinput';
    table.search.casesensitive = false;
    table.style.num = false;
    table.rendertable();
});
</script>

{% endblock %}